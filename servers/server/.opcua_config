local ua = require("opcua.api")

local listenPort=4841
local ip = "localhost"

local s,err = ba.socket.connect("google.com",80)
if s then
  local _,_,ips = string.find(s:sockname(), "(%d+.%d+.%d+.%d+)")
  ip = ips
  s:close()
end

local suc, conf = pcall(require, "loadconf")
if suc then
  conf = conf.opcua
end

if not conf then
  conf = {
    bufSize = 16384,

    securePolicies = {
      {
        securityPolicyUri = ua.Types.SecurityPolicy.None,
      }
    },

    logging = {
      socket = {
        dbgOn = false,
        infOn = false,
        errOn = true,
      },
      binary = {
        dbgOn = false,
        infOn = false,
        errOn = true,
      },
      services = {
        dbgOn = false,
        infOn = false,
        errOn = true,
      }
    }
  }
end

if conf.listenPort == nil then
  conf.listenPort=listenPort
end
if conf.listenAddress == nil then
  listenAddress=ip
end

if conf.endpointUrl == nil then
  conf.endpointUrl=string.format("opc.tcp://%s:%s", ip, listenPort)
end

return conf
