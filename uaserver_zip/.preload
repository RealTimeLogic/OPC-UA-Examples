trace("Starting opcua server")

local ua = require("opcua.api")
conf = io:dofile(".opcua_config")
local function demoAddon(services)
  local objects = "i=40"
  io:dofile(".lua/add_variables.lua")(services, objects)
end

-- Connect logging traces
local sock = require("socket")
ua.trace.dbg = function(msg)
  trace(sock.gettime(), "[DBG] ", msg)
end

ua.trace.inf = function(msg)
  trace(sock.gettime(), "[INF]", msg)
end

ua.trace.err = function(msg)
  trace(sock.gettime(), "[ERR]", msg)
end


uaServer = ua.newServer(conf)
uaServer:initialize(demoAddon)
uaServer:run()

assert(uaServer.services ~= nil)

uaClient = io:dofile(".lua/lspclient.lua").New(uaServer.services)
